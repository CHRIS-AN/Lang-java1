



시스템 프로그래밍 기본
프로세스 관리 - 프로세스 생성


exec() 시스템 콜


1. execl() 시스템 콜 예

    #include <unistd.h>
    #include <stdio.h>
    #include <stdlib.h>

    int main() {
        printf("execute ls\n");
        execl("/bin/ls", "ls", "-l", NULL);       -> code 영역에 ls 실행파일이 덮어씌어진다.
        perror("execl is failed\n");              -> 에러 출력
        exit(1);                                  -> 에로코드 전달

    * 정상적인 코드에서는 아래 두 줄 코드는실행이 되서는 안된다.

    }

execl() 시스템콜과 다른 함수들 차이.
    execlp() 시스템 콜은? 실행파일만 적어주면되고, 디렉토리르 다 적어 줄 필요가 없다. 환경 변수가 적혀있는 것이다.
    execle() 시스템 콜은? 환경 변수를 path 값이 지정되어있다 하더라도, 사용자가 따로 환경변수(path)를 지정하고자 할 때, 쓰인다.
    execv(), execvp(), execve() - 환경변수도 사용자가 지정해서 만들어서 넣고, 인자도 사용자가 지정해서 넣을 수 있다.



wait() 시스템 콜

    wait() 함수를 사용하면, fork() 함수 호출 시, 자식 프로세스가 종료할 때까지, 부모 프로세스가 기다림
    자식 프로세스와 부모 프로세스의 동기화, 부모 프로세스가 자식 프로세스보다 먼저 죽는 경우를 막기 위해 사용 (고아 프로세스)

    'SIGCHLD' 시그널이 자식프로세스가 종료되면, 부모 프로세스 쪽에 보낸다.

    #include <sys/wait.h>
    pid_t wait (int *status)
    // 리턴 값은 종료된 자식 프로세스의 pid
        * status 정보를 통해 기본적인 자식 프로세스 관련 정보를 확인할 수 있음.


자식 프로세스의 상태값을 알기 위해서는?
    예 ) int WIFEXITED(status); // 자식 프로세스가 정상 종료 시 리턴 값은 0이 아닌 값이 됨













copy-on-write
    자식 프로세스 생성 시, 부모 프로세스 페이지를 우선 사용
    부모 또는 자식 프로세스가 해당 페이지를 읽기가 아닌, 쓰기를 할 때? (읽기는 계속 부모 프로세스를 사용)
        이 때 페이지를 복사하고 분리함.

    *장점 :
        프로세스 생성 시간을 줄일 수 있음
        새로 생성된 프로세스에 새롭게 할당되어야 하는 페이지 수도 최소화.


exit() 시스템 콜 : 프로세스 종료

    #include <stdlib.h>
    void exit(int status);   --> 프로세스 종료 상태를 나타내는 번호를 넣게 되어있다.

main 함수의 return 0;와 exit(0); 의 차이는?
    exit()함수 : 즉시 프로세스를 종료함 (exit() 함수 다음에 있는 코드는 실행되지 않음)
    return 0 : 단지 main() 이라는 함수를 종료함.
        단, main() 에서 return 시, C 언어 실행 파일에 기본으로 포함된 _start() 함수를 호출하게 되고, 해당 함수는 결국 exit() 함수를 호출함


exit(EXIT_SUCCESS); // 0
exit(EXIT_FAILURE); // 1


exit () 시스템콜 주요동작
    - atexit() 에 등록된 함수 실행
    - 열려 있는 모든 입출력 스트림 버퍼 삭제    (stdin, stdout, stderr)을 삭제해준다.
    - 프로세스가 오픈한 파일을 모두 닫음
    - tmpfile() 함수를 통해 생성한 임시 파일 삭제
        참고: tmfile() - 임시 파일을 wb+ (쓸 수 있는 이진파일 형태) 모드로 오픈 가능

atexit() 함수
    - 프로세스가 종료 시 실행될 함수르 등록하기 위해 사용



















